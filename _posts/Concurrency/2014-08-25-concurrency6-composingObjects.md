---
layout: default
tags: concurrency
title: 并发编程学习笔记（6）-对象的组合
---

#并发编程学习笔记（6）-对象的组合#

摘录于[《Java并发编程实战》](http://book.douban.com/subject/10484692/)

## 在现有的线程安全类中添加功能 ##

在不破坏线程安全性的情况下添加一个新的原子操作，最安全的方法是修改原始的类，这样实现同步策略的所有代码仍然处于一个源代码文件中，从而更容易理解与维护，但通常由于源代码无法访问而无法做到。

第二种方法是扩展（`extends`）这个类，但由于同步策略实现被分布到多个单独维护的源代码文件中，因此比较脆弱，即底层的同步策略改变将影响到其子类。

第三种方法是扩展类的功能，但并不是扩展类本身，而是将扩展代码放入一个“辅助类”中。

客户端加锁是指，对于使用某个对象X的客户端代码，使用X本身用于保护其状态的锁来保护这段客户代码。客户端加锁更加脆弱，因为它将类X的加锁代码放到与X完全无关的其他类中。

第四种方法是组合。通过自身的内置锁增加了一层额外的加锁。不管底层对象是否线程安全或者修改了它的加锁实现，包含对象都会提供一致的加锁机制来实现线程安全性，**只要在类中拥有底层对象的唯一外部引用**。事实上，这就是 Java 监视器模式。