---
layout: default
tags: js
title: javascript 学习笔记2--垃圾回收器
---

# javascript 学习笔记2--垃圾回收器 #

摘录于[《JavaScript高级程序设计:第2版》](http://book.douban.com/subject/4886879/)

##标记清除##

JavaScript 中最常用的垃圾收集方式是标记清除（mark-and-sweep）。当变量进入环境时，就将这个变量标记为“**进入环境**”。从逻辑上来讲，永远不能释放进入环境的变量所用的内存，因为只要执行流进入相应的环境，就可能用到它们。而当变量离开环境时，则将其标记为“**离开环境**”。

##引用计数##

IE 中有一部分对象并不是原生的 JavaScript 对象，例如，其 BOM 和 DOM 中的对象就是使用 C++ 以 COM（Component Object Model，组件对象模型）对象的形式实现的，而 COM 对象的垃圾收集机制采用的就是引用计数策略，因此，即使在 IE 的 JavaScript 引擎是使用标记清除策略来实现的，但 JavaScript 访问的 COM 对象依然是基于引用计数策略的。换句话说，只要在 IE 中涉及 COM 对象，就会存在循环引用问题。

为了避免这个问题，最好在不使用它们的时候手工断开原生 JavaScript 对象与 DOM 元素之间的连接。

##性能问题##

垃圾收集器是周期运行的。

在 IE6 以及更早版本中，存在着严重的性能问题。它们的垃圾收集器是根据内存分配量运行的。这种实现方式的问题在于，如果一个脚本中包含那么多变量，那么该脚本很可能会在其生命周期中一直保有这么多的变量。而这样一来，垃圾收集器就不得不频繁地运行。

IE7 改变了工作方式：触发垃圾收集的变量分配、字面量和（或）数组元素的临界值被调整为**动态修正**。如果垃圾收集例程回收的内存分配量低于15%，则各项临界值就会加倍。如果例程回收了85%的内存分配量，则将各项临界值重置回默认值。

##管理内存##

一旦数据不再有用，最好通过将其值设置为 null 来释放其引用--这个做法叫做**解除引用（dereference）**。这一做法适用于大多数全局变量和全局对象的属性。局部变量会在它们离开执行环境时自动被解除引用。


